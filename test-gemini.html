<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API ãƒ†ã‚¹ãƒˆ - DataAnalyzer Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Configuration -->
    <script src="config.js"></script>
    
    <!-- AI Integration -->
    <script src="gemini-integration.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .test-result {
            transition: all 0.3s ease;
        }
        
        .success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .loading {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="hero-gradient text-white p-8">
        <div class="container mx-auto text-center">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-robot mr-3"></i>
                Gemini API ãƒ†ã‚¹ãƒˆ
            </h1>
            <p class="text-xl opacity-90">
                AIæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8 max-w-4xl">
        
        <!-- API Status -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                APIè¨­å®šçŠ¶æ…‹
            </h2>
            
            <div id="apiStatus" class="space-y-3">
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-gray-400 rounded-full mr-3"></span>
                    <span>è¨­å®šã‚’ç¢ºèªä¸­...</span>
                </div>
            </div>
        </div>

        <!-- Test Cases -->
        <div class="grid md:grid-cols-2 gap-6 mb-8">
            
            <!-- Basic Test -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-play-circle mr-2 text-green-600"></i>
                    åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ
                </h3>
                <p class="text-gray-600 mb-4">
                    Gemini APIã¨ã®åŸºæœ¬çš„ãªæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™
                </p>
                <button onclick="runBasicTest()" id="basicTestBtn" 
                    class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-rocket mr-2"></i>
                    åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
                <div id="basicTestResult" class="mt-4"></div>
            </div>

            <!-- Analysis Test -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-chart-line mr-2 text-purple-600"></i>
                    åˆ†æè§£é‡ˆãƒ†ã‚¹ãƒˆ
                </h3>
                <p class="text-gray-600 mb-4">
                    å®Ÿéš›ã®åˆ†æãƒ‡ãƒ¼ã‚¿ã§ã®è§£é‡ˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™
                </p>
                <button onclick="runAnalysisTest()" id="analysisTestBtn"
                    class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-brain mr-2"></i>
                    åˆ†æãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
                <div id="analysisTestResult" class="mt-4"></div>
            </div>
        </div>

        <!-- Performance Test -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-stopwatch mr-2 text-orange-600"></i>
                ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
            </h3>
            <div class="grid md:grid-cols-3 gap-4 mb-4">
                <button onclick="runSpeedTest()" id="speedTestBtn"
                    class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-tachometer-alt mr-2"></i>
                    å¿œç­”é€Ÿåº¦ãƒ†ã‚¹ãƒˆ
                </button>
                <button onclick="runMultipleTest()" id="multipleTestBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-list mr-2"></i>
                    è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ
                </button>
                <button onclick="runAllTests()" id="allTestsBtn"
                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-check-double mr-2"></i>
                    å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                </button>
            </div>
            <div id="performanceTestResult"></div>
        </div>

        <!-- Test Results -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-clipboard-list mr-2 text-indigo-600"></i>
                ãƒ†ã‚¹ãƒˆçµæœãƒ­ã‚°
            </h3>
            <div id="testLog" class="bg-gray-50 rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                <!-- Test logs will appear here -->
            </div>
            <div class="mt-4 flex justify-end space-x-2">
                <button onclick="clearLog()" class="text-gray-600 hover:text-gray-800 px-3 py-1 text-sm">
                    <i class="fas fa-trash mr-1"></i>ãƒ­ã‚°ã‚¯ãƒªã‚¢
                </button>
                <button onclick="exportLog()" class="text-blue-600 hover:text-blue-800 px-3 py-1 text-sm">
                    <i class="fas fa-download mr-1"></i>ãƒ­ã‚°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
            </div>
        </div>

        <!-- Back to Analyzer -->
        <div class="text-center mt-8">
            <a href="analyzer.html" class="inline-flex items-center bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>
                åˆ†æãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
            </a>
        </div>
    </div>

    <script>
        let testLogs = [];

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
            log('ğŸš€ Gemini APIãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'info');
        });

        // APIè¨­å®šçŠ¶æ…‹ã®ç¢ºèª
        function checkApiStatus() {
            const statusElement = document.getElementById('apiStatus');
            
            try {
                // è¨­å®šã®ç¢ºèª
                if (typeof CONFIG === 'undefined') {
                    showStatus(statusElement, 'error', 'CONFIG ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return;
                }

                if (!CONFIG.GEMINI || !CONFIG.GEMINI.API_KEY) {
                    showStatus(statusElement, 'error', 'Gemini APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }

                if (CONFIG.GEMINI.API_KEY === 'YOUR_GEMINI_API_KEY_HERE') {
                    showStatus(statusElement, 'error', 'APIã‚­ãƒ¼ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ã¾ã¾ã§ã™');
                    return;
                }

                if (!CONFIG.GEMINI.API_KEY.startsWith('AIza')) {
                    showStatus(statusElement, 'error', 'APIã‚­ãƒ¼ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                    return;
                }

                // Gemini ã‚µãƒ¼ãƒ“ã‚¹ã®ç¢ºèª
                if (typeof geminiService === 'undefined' || !geminiService) {
                    showStatus(statusElement, 'warning', 'Gemini ã‚µãƒ¼ãƒ“ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }

                if (!geminiService.isConfigured()) {
                    showStatus(statusElement, 'warning', 'Gemini ã‚µãƒ¼ãƒ“ã‚¹ãŒç„¡åŠ¹ã§ã™');
                    return;
                }

                showStatus(statusElement, 'success', 'APIè¨­å®šãŒæ­£å¸¸ã§ã™');
                log('âœ… APIè¨­å®šç¢ºèªå®Œäº†', 'success');

            } catch (error) {
                showStatus(statusElement, 'error', `è¨­å®šç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log(`âŒ APIè¨­å®šç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus(element, type, message) {
            const colors = {
                success: 'text-green-600 bg-green-600',
                warning: 'text-yellow-600 bg-yellow-600', 
                error: 'text-red-600 bg-red-600',
                info: 'text-blue-600 bg-blue-600'
            };

            const icons = {
                success: 'fas fa-check-circle',
                warning: 'fas fa-exclamation-triangle',
                error: 'fas fa-times-circle',
                info: 'fas fa-info-circle'
            };

            element.innerHTML = `
                <div class="flex items-center">
                    <span class="w-3 h-3 ${colors[type].split(' ')[1]} rounded-full mr-3"></span>
                    <i class="${icons[type]} ${colors[type].split(' ')[0]} mr-2"></i>
                    <span class="${colors[type].split(' ')[0]}">${message}</span>
                </div>
            `;
        }

        // åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function runBasicTest() {
            const button = document.getElementById('basicTestBtn');
            const result = document.getElementById('basicTestResult');
            
            log('ğŸ”„ åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            showTestLoading(button, result, 'åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...');

            try {
                const startTime = Date.now();
                const response = await geminiService.callGeminiAPI('ã“ã‚“ã«ã¡ã¯ï¼ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚ã€ŒOKã€ã¨è¿”ç­”ã—ã¦ãã ã•ã„ã€‚');
                const endTime = Date.now();
                const duration = endTime - startTime;

                showTestSuccess(button, result, `
                    <strong>æ¥ç¶šæˆåŠŸ!</strong><br>
                    å¿œç­”æ™‚é–“: ${duration}ms<br>
                    ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${response.substring(0, 100)}...
                `);
                
                log(`âœ… åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ (${duration}ms)`, 'success');

            } catch (error) {
                showTestError(button, result, `æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log(`âŒ åŸºæœ¬æ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // åˆ†æè§£é‡ˆãƒ†ã‚¹ãƒˆ
        async function runAnalysisTest() {
            const button = document.getElementById('analysisTestBtn');
            const result = document.getElementById('analysisTestResult');
            
            log('ğŸ”„ åˆ†æè§£é‡ˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            showTestLoading(button, result, 'åˆ†æè§£é‡ˆãƒ†ã‚¹ãƒˆä¸­...');

            try {
                const startTime = Date.now();
                
                // ã‚µãƒ³ãƒ—ãƒ«ç›¸é–¢åˆ†æçµæœ
                const sampleResults = {
                    pearsonR: 0.85,
                    spearmanR: 0.82
                };
                
                const context = {
                    xColumn: 'æ¸©åº¦',
                    yColumn: 'å“è³ªã‚¹ã‚³ã‚¢',
                    industry: 'è£½é€ æ¥­',
                    dataType: 'å“è³ªãƒ‡ãƒ¼ã‚¿',
                    sampleSize: 100
                };

                const interpretation = await geminiService.enhanceCorrelationInterpretation(
                    sampleResults, 
                    context.xColumn, 
                    context.yColumn, 
                    context
                );
                
                const endTime = Date.now();
                const duration = endTime - startTime;

                showTestSuccess(button, result, `
                    <strong>åˆ†æè§£é‡ˆæˆåŠŸ!</strong><br>
                    å‡¦ç†æ™‚é–“: ${duration}ms<br>
                    è§£é‡ˆé•·: ${interpretation.length}æ–‡å­—
                `);
                
                log(`âœ… åˆ†æè§£é‡ˆãƒ†ã‚¹ãƒˆæˆåŠŸ (${duration}ms)`, 'success');

            } catch (error) {
                showTestError(button, result, `åˆ†æè§£é‡ˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log(`âŒ åˆ†æè§£é‡ˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // å¿œç­”é€Ÿåº¦ãƒ†ã‚¹ãƒˆ
        async function runSpeedTest() {
            const button = document.getElementById('speedTestBtn');
            const result = document.getElementById('performanceTestResult');
            
            log('ğŸ”„ å¿œç­”é€Ÿåº¦ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            showTestLoading(button, result, 'å¿œç­”é€Ÿåº¦æ¸¬å®šä¸­...');

            try {
                const tests = [];
                for (let i = 0; i < 3; i++) {
                    const startTime = Date.now();
                    await geminiService.callGeminiAPI(`ãƒ†ã‚¹ãƒˆ${i + 1}: çŸ­ã„å¿œç­”ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚`);
                    const endTime = Date.now();
                    tests.push(endTime - startTime);
                }

                const avgTime = tests.reduce((a, b) => a + b, 0) / tests.length;
                const minTime = Math.min(...tests);
                const maxTime = Math.max(...tests);

                showTestSuccess(button, result, `
                    <strong>å¿œç­”é€Ÿåº¦ãƒ†ã‚¹ãƒˆå®Œäº†</strong><br>
                    å¹³å‡: ${avgTime.toFixed(0)}ms<br>
                    æœ€é€Ÿ: ${minTime}ms / æœ€é…: ${maxTime}ms
                `);
                
                log(`âœ… å¿œç­”é€Ÿåº¦ãƒ†ã‚¹ãƒˆå®Œäº† - å¹³å‡: ${avgTime.toFixed(0)}ms`, 'success');

            } catch (error) {
                showTestError(button, result, `é€Ÿåº¦ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log(`âŒ å¿œç­”é€Ÿåº¦ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ
        async function runMultipleTest() {
            const button = document.getElementById('multipleTestBtn');
            const result = document.getElementById('performanceTestResult');
            
            log('ğŸ”„ è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...', 'info');
            showTestLoading(button, result, 'è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ä¸­...');

            try {
                const promises = [];
                for (let i = 0; i < 3; i++) {
                    promises.push(geminiService.callGeminiAPI(`ä¸¦åˆ—ãƒ†ã‚¹ãƒˆ${i + 1}: ç¢ºèª`));
                }

                const startTime = Date.now();
                const results = await Promise.all(promises);
                const endTime = Date.now();
                const totalTime = endTime - startTime;

                showTestSuccess(button, result, `
                    <strong>è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆå®Œäº†</strong><br>
                    åŒæ™‚å®Ÿè¡Œ: 3ãƒªã‚¯ã‚¨ã‚¹ãƒˆ<br>
                    ç·æ™‚é–“: ${totalTime}ms
                `);
                
                log(`âœ… è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆå®Œäº† - ${totalTime}ms`, 'success');

            } catch (error) {
                showTestError(button, result, `è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                log(`âŒ è¤‡æ•°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        async function runAllTests() {
            const button = document.getElementById('allTestsBtn');
            
            log('ğŸ”„ å…¨ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
            button.disabled = true;

            try {
                await runBasicTest();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await runAnalysisTest();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await runSpeedTest();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                await runMultipleTest();

                button.innerHTML = '<i class="fas fa-check mr-2"></i>å…¨ãƒ†ã‚¹ãƒˆå®Œäº†';
                button.className = button.className.replace('bg-red-600', 'bg-green-600');
                log('ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼', 'success');

            } catch (error) {
                button.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>ãƒ†ã‚¹ãƒˆä¸­æ–­';
                button.className = button.className.replace('bg-red-600', 'bg-red-600');
                log(`âŒ å…¨ãƒ†ã‚¹ãƒˆä¸­æ–­: ${error.message}`, 'error');
            } finally {
                button.disabled = false;
            }
        }

        // ãƒ†ã‚¹ãƒˆçŠ¶æ…‹è¡¨ç¤ºé–¢æ•°
        function showTestLoading(button, result, message) {
            button.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>${message}`;
            button.disabled = true;
            result.innerHTML = `
                <div class="test-result loading text-white p-3 rounded-lg">
                    <i class="fas fa-spinner fa-spin mr-2"></i>${message}
                </div>
            `;
        }

        function showTestSuccess(button, result, message) {
            button.innerHTML = `<i class="fas fa-check mr-2"></i>ãƒ†ã‚¹ãƒˆå®Œäº†`;
            button.disabled = false;
            result.innerHTML = `
                <div class="test-result success text-white p-3 rounded-lg">
                    <i class="fas fa-check-circle mr-2"></i>${message}
                </div>
            `;
        }

        function showTestError(button, result, message) {
            button.innerHTML = `<i class="fas fa-exclamation-triangle mr-2"></i>å†è©¦è¡Œ`;
            button.disabled = false;
            result.innerHTML = `
                <div class="test-result error text-white p-3 rounded-lg">
                    <i class="fas fa-times-circle mr-2"></i>${message}
                </div>
            `;
        }

        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLogs.push({ timestamp, message, type });
            
            const logElement = document.getElementById('testLog');
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            logElement.innerHTML += `<div class="${colors[type]}">${logEntry}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            testLogs = [];
            document.getElementById('testLog').innerHTML = '';
            log('ğŸ“‹ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        }

        function exportLog() {
            const logText = testLogs.map(entry => 
                `[${entry.timestamp}] ${entry.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gemini-test-log-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('ğŸ’¾ ãƒ­ã‚°ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
        }
    </script>
</body>
</html>